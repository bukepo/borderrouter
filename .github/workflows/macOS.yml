name: macOS

on: [push, pull_request]

jobs:

  cancel-previous-runs:
    runs-on: ubuntu-latest
    steps:
    - uses: rokroskar/workflow-run-cleanup-action@master
      env:
        GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}"
      if: "github.ref != 'refs/heads/master'"

  build-check:
    runs-on: macos-10.15
    steps:
    - uses: actions/checkout@v2
      with:
        submodules: true
    - name: Bootstrap
      run: |
        # On Travis, brew install fails when a package is already installed, so use reinstall here instead of ./script/bootstrap
        brew unlink python@2 || true
        brew reinstall boost cmake cpputest dbus jsoncpp ninja
    - name: Build
      run: |
        OTBR_OPTIONS='-DOTBR_MDNS=OFF' ./script/test build
